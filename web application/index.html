<!DOCTYPE html>
<html>
<head>
<!--  // Using special characters-->
<meta http-equiv="content-type" content="text/html; charset=iso-8859-1">
<!-- Jquery-->
<link rel="stylesheet" href="http://code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.css">
 <script src="http://code.jquery.com/jquery-1.9.1.js"></script>
 <script src="http://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>
 <script src="libraries/jQuery.js"></script>
 <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>

<!-- Map environment-->
<link rel="stylesheet" href="libraries/leaflet-0.7/leaflet.css" />
    <link rel="stylesheet" href="libraries/Leaflet.draw/dist/leaflet.draw.css" />
	<link rel="stylesheet" href="libraries/MiniMap/fullscreen.css" />
	<link rel="stylesheet" href="libraries/MiniMap/src/Control.MiniMap.css" />

	<link rel="stylesheet" href="libraries/Measure/leaflet.measurecontrol.css" />
	<link rel="stylesheet" href="libraries/L.Control.Sidebar.css" />
	
	<script src="http://cdn.leafletjs.com/leaflet-0.7/leaflet.js"></script>
	<script src="libraries/Leaflet.draw/dist/leaflet.draw.js" type="text/javascript"></script>
    <script src="libraries/MiniMap/src/Control.MiniMap.js" type="text/javascript"></script>
	<script src="libraries/Measure/leaflet.measurecontrol.js" type="text/javascript"></script>
	
	<script type='text/javascript' src="libraries/GeometryUtil/dist/leaflet.geometryutil.js"></script>
	<script type='text/javascript' src="libraries/leaflet.almostover.js"></script>
	
	<script type="text/javascript" src="libraries/L.Control.Sidebar.js"></script>
<!-- created style sheets and scripts-->
<link href="libraries/bootstrap/css/bootstrap.css" rel="stylesheet">
<link rel="stylesheet" href="libraries/custom_css.css"/>

<!-- SPARQL library-->
<script type="text/javascript" src="libraries/sparql.js"></script>


<!--Add WL boundary Geojson as JS variable WLBoundaries"/>-->
<script type="text/javascript" src="data/WL_boundaries_WGS84.js"></script>


<!--Json merge for visualization"/>-->
<script type="text/javascript" src="libraries/jsonmerge.js"></script>

<!--Json merge for sir value"/>-->
<script type="text/javascript" src="libraries/jsonmerge_sir.js"></script> 

<!--Add functions for the sparql panel/>-->
<script type="text/javascript" src="ibraries/sparqlpanel.js"></script>

<!--Validation"/>-->
<script type="text/javascript" src="libraries/validation.js"></script>


<style>
<!--Info from hover box>-->
.info {
    padding: 6px 8px;
    font: 14px/16px Arial, Helvetica, sans-serif;
    background: white;
    background: rgba(255,255,255,0.8);
    box-shadow: 0 0 15px rgba(0,0,0,0.2);
    border-radius: 5px;
}
.info h4 {
    margin: 0 0 5px;
    color: #777;
}


.info2 {
    padding: 6px 8px;
    font: 14px/16px Arial, Helvetica, sans-serif;
    background: white;
    background: rgba(255,255,255,0.8);
    box-shadow: 0 0 15px rgba(0,0,0,0.2);
    border-radius: 5px;
}
.info2 h4 {
    margin: 0 0 5px;
    color: #777;
}


#map { 
            position: absolute;
            top:0;
            left: 0;
            right: 0;
            bottom:0;
        }
        .leaflet-control.enabled a {
            background-color: yellow;
        }

</style>
 <style type="text/css">
        #qsizemin {
            width: 60px;
        }
        #qpricemin {
            width: 60px;
        }
        #qminlodger {
            width: 60px;
        }
        #qsizemax {
            width: 60px;
        }
        #qpricemax {
            width: 60px;
        }
        #qmaxlodger {
            width: 60px;
        }
        #qminroom {
            width: 60px;
        }
        #qzip {
            width: 60px;
        }
        #qmaxroom {
            width: 60px;
        }
    </style>
<style>
		#map {
			width: 800px;
			height: 500px;
		}

		.info {
			padding: 6px 8px;
			font: 14px/16px Arial, Helvetica, sans-serif;
			background: white;
			background: rgba(255,255,255,0.8);
			box-shadow: 0 0 15px rgba(0,0,0,0.2);
			border-radius: 5px;
		}
		.info h4 {
			margin: 0 0 5px;
			color: #777;
		}

		.legend {
			text-align: left;
			line-height: 18px;
			color: #555;
		}
		.legend i {
			width: 18px;
			height: 18px;
			float: left;
			margin-right: 8px;
			opacity: 0.7;}
			
			
			.btnStyle {
	background-color: #4D90FE; 
	background-image: -moz-linear-gradient(center top , #4D90FE, #4787ED); 
	border: 1px solid #3079ED; 
	color: #FFFFFF;
    padding: 4px;
    margin-top: 4px;
    margin-bottom: 4px;
    width:100%
}

	.lblStyle {
	color: red;
	padding: 4px;
	margin-top: 4px;
	margin-bottom: 4px;
	width: 100%;
	font-weight: bold;
}
		
	</style>
	

<title>CancerExplorer</title>


</head>


<body style="background-color:#000000">

		
<div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
		  <!--<div style="position:absolute;left:30%;top:20%;"><button type="button" onclick="Query()">Query</button></div>-->
		  <a class="navbar-brand" href="#">Cancer Explorer</a>
        </div>
        <div class="collapse navbar-collapse">
          <ul class="nav navbar-nav">
			<li onclick="" class="active"><a href="#">Map</a></li>
			
			<li onclick="Sparql_panel_edit()"><a href="#">SPARQL Query</a></li>
            <li onclick="Query()"><a href="#">Explore cancer incidents</a></li>
			<li onclick="Explore_cause_effect();"><a href="#">Explore cause-effect relations</a></li>
			<li onclick="mylocation()"><a href="#">Get my location</a></li>
			
			
			<!--Add information:-->
			<li onclick=""><a href="#">Further links</a></li>
			
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </div>

<!-- Main div structure on page-->
<div class="container">

<div id="map" style="position:absolute;left:25px; top:51px; width: 96%; height: 80%;" >
	
 
  
 
  
 
  
 <!-- sir sidebar -->

 <div id="sir_sidebar"> 
	<br> <b><font size=4px>Choose a certain Standardized Incidence Ratio (SIR) visualization:  </b></font>
	<br>
	<div style="padding-top:15px">
	<b><font size=3px>Choose a cancer type:</b></font>
	</div>
	<div style="border: thin solid #000000; border-bottom-width: 0px;">
	</div>
	<div style="padding-top:10px">
		<input type="radio" id="sirbladdercancer" class="obsType" name="obsType" value="C67" checked="checked">&nbsp;Bladder cancer &nbsp;
		<input type="radio" id="sirlungcancer" class="obsType" name="obsType" value="C34">&nbsp;Lung cancer &nbsp;
		<input type="radio" id="sirleukemiacancer" class="obsType" name="obsType" value="C91-C95">&nbsp;Leukemia &nbsp;&nbsp;&nbsp;<br>
		<input type="radio" id="sirnasalcancer" class="obsType" name="obsType" value="C00-C14">&nbsp;Nasal cavity and paranasal sinus &nbsp;
		
	</div>
	<br>
	
	<div style="padding-top:15px">
	<b><font size=3px>Choose a year:</b></font>
	</div>
	<div style="border: thin solid #000000; border-bottom-width: 0px;">
	</div>
	<div style="padding-top:10px">
		<input type="radio" id="sir2006" name="obsType1" value="2006">&nbsp;2006 &nbsp;
		<input type="radio" id="sir2007" name="obsType1" value="2007">&nbsp;2007 &nbsp;
		<input type="radio" id="sir2008" name="obsType1" value="2008">&nbsp;2008 &nbsp;
		<input type="radio" id="sir2009" name="obsType1" value="2009">&nbsp;2009 &nbsp;
		<input type="radio" id="sir2010" name="obsType1" value="2010">&nbsp;2010 &nbsp;
		<input type="radio" id="sir2011" name="obsType1" value="2011">&nbsp;2011 &nbsp;
	</div>
		
	<div style="padding-top:15px">
	<b><font size=3px>Choose a gender:</b></font>
	</div>
	<div style="border: thin solid #000000; border-bottom-width: 0px;">
	</div>
	<div style="padding-top:10px">
		<input type="radio" id="sirfemale" name="obsType2" value="w">&nbsp;female
		<input type="radio" id="sirmale" name="obsType2" value="m">&nbsp;male &nbsp;&nbsp;
		
		
	</div>
		
	<br>
	<button type="button" onclick="sir_clear()" class="btnStyle span3">Clear</button>
	<button type="button" onclick="ini_sir()" class="btnStyle span3">Visualize SIR</button>
	<button type="button" onclick="ini_cilower()" class="btnStyle span3">Visualize CI 95 Lower Level</button> 
	<button type="button" onclick="ini_ciupper()" class="btnStyle span3">Visualize CI 95 Upper Level</button>
	
</div>


 <div id="SPARQLPanel">
	

	<!-- empty html div-element ... placeholder for results (text/canvas/map etc)-->
	<div id="resultdiv"></div>
	<br/>
  </div>
  
<div id="SPARQLPanel_edit">
<textarea id="sparqlQuery" rows="5" cols="40" class="field span12">Select ?a ?b ?c WHERE {?a ?b ?c} Limit 10</textarea><br/>
	<button type="submit" class="btn btn-primary" onclick="SPedit()">Submit Query</button><br/><br/>

	<!-- empty html div-element ... placeholder for results (text/canvas/map etc)-->
	<div id="resultdiv_edit"></div>
	<br/>	

	
  </div>



<!-- Definition of link sidebar-->
<!-- Currently not used-->


 <div id="sidebarLinks"> 

<h>Here should be some further information.</h>
<br>

</div>




<div id="Cause_Effect_Panel"> 

<br> <b><font size=4px>Get more information about cancer causes:  </b></font>
	<br>
	<div style="padding-top:15px">
	<b><font size=3px>Choose a cancer type:</b></font>
	</div>
	<div style="border: thin solid #000000; border-bottom-width: 0px;">
	</div>
	<div style="padding-top:10px">
		<input type="radio" id="sirbladdercancer" class="obsType" name="obsType3" value="C67" checked="checked">&nbsp;Bladder cancer &nbsp;
		<input type="radio" id="sirlungcancer" class="obsType" name="obsType3" value="C34">&nbsp;Lung cancer &nbsp;
		<input type="radio" id="sirleukemiacancer" class="obsType" name="obsType3" value="C91-C95">&nbsp;Leukemia &nbsp;&nbsp;&nbsp;<br>
		<input type="radio" id="sirnasalcancer" class="obsType" name="obsType3" value="C00-C14">&nbsp;Nasal cavity and paranasal sinus &nbsp;		
	</div>
	<br>
	<button type="button" onclick="ini_carcinogen()" class="btnStyle span3">Information about carcinogens of a type of cancer- Please choose a cancer type </button>


</div>




 

</div>
</div>
 
<script>
var info = L.control();
var secondquery=false;
var querynumber=0;

// Check the selections, submit parameter to the SPARQL/AJAX function

function ini_sir () {

$('#year_list').click(function(){
    alert($("input[name='obstype1']:checked").val());
});

var sir_cancer
var sir_year
var sir_gender
var sir_cancer_add
var check_choice="SIR";
secondquery=true;
querynumber=querynumber+1;
$(document).ready(function(){

sir_cancer = $("input:radio[name ='obsType']:checked").val()
sir_year=$('input[name="obsType1"]:checked').val();
sir_gender=$('input[name="obsType2"]:checked').val();
if (sir_input_check()==true){

visualize_sir (sir_cancer,sir_cancer_add,sir_year,sir_gender,check_choice);
}
});

}

function ini_cilower () {

$('#year_list').click(function(){
    alert($("input[name='obstype1']:checked").val());
});

var sir_cancer
var sir_year
var sir_gender
var sir_cancer_add
var check_choice="CI_lower_level";
$(document).ready(function(){

sir_cancer = $("input:radio[name ='obsType']:checked").val()
sir_year=$('input[name="obsType1"]:checked').val();
sir_gender=$('input[name="obsType2"]:checked').val();
secondquery=true;
querynumber=querynumber+1;
if (sir_input_check()==true){
visualize_sir(sir_cancer,sir_cancer_add,sir_year,sir_gender,check_choice);
}
});

}


function ini_ciupper () {

$('#year_list').click(function(){
    alert($("input[name='obstype1']:checked").val());
});

var sir_cancer
var sir_year
var sir_gender
var sir_cancer_add
var check_choice="CI_upper_level";
$(document).ready(function(){
secondquery=true;
querynumber=querynumber+1;
sir_cancer = $("input:radio[name ='obsType']:checked").val()
sir_year=$('input[name="obsType1"]:checked').val();
sir_gender=$('input[name="obsType2"]:checked').val();

if (sir_input_check()==true){
visualize_sir(sir_cancer,sir_cancer_add,sir_year,sir_gender,check_choice);
}
});

}

function ini_carcinogen () {

$('#year_list').click(function(){
    alert($("input[name='obstype1']:checked").val());
});


var sir_cancer
var sir_year
var sir_gender
var check_choice="Carcinogen";
$(document).ready(function(){

sir_cancer = $("input:radio[name ='obsType3']:checked").val()
if (sir_cancer=="C67"){
sir_cancer="Bladder";
sir_cancer_add="Cancer";
}
if (sir_cancer=="C34"){
sir_cancer="Lung";
sir_cancer_add="Cancer";
}
if (sir_cancer=="C00-C14"){
sir_cancer="Nasal_cavity_and_paranasal_sinus";
sir_cancer_add="";
}
if (sir_cancer=="C91-C95"){
sir_cancer="Leukemia";
sir_cancer_add="";
}
sir_year=$('input[name="obsType1"]:checked').val();
sir_gender=$('input[name="obsType2"]:checked').val();

if (inci_input_check()==true){
visualize_sir(sir_cancer,sir_cancer_add,sir_year,sir_gender,check_choice);
}
});

}


//Functions for map display

function getColor(d) {
    return d > 5550000 ? '#800026' :
           d > 5555000  ? '#BD0026' :
           d > 5560000  ? '#E31A1C' :
           d > 5556500  ? '#FC4E2A' :
           d > 5570000   ? '#FD8D3C' :
           d > 5575000   ? '#FEB24C' :
           d > 5580000   ? '#FED976' :
                      '#FFEDA0';
}

function style(feature) {
    return {
        fillColor: getColor(feature.properties.GKZ),
        weight: 2,
        opacity: 1,
        color: 'white',
        dashArray: '3',
        fillOpacity: 0.7
    };
}



//create map
var map = new L.Map('map', {
            //crs: L.CRS.EPSG3857,
            center: [51.95442, 7.62709],
            zoom: 7,
			zoomcontrol:true
			});
			
			// Add our zoom control manually where we want to
var zoomControl = L.control.zoom({
position: 'topright'
});
map.addControl(zoomControl);

 
			

// sidebars

var sir_sidebar = L.control.sidebar('sir_sidebar', {
    position: 'right'
});


var SPARQLPanel = L.control.sidebar('SPARQLPanel', {
    position: 'right'
});


var SPARQLPanel_edit = L.control.sidebar('SPARQLPanel_edit', {
    position: 'right'
});


var sidebarLinks = L.control.sidebar('sidebarLinks', {
    position: 'right'
});

var Cause_Effect_Panel = L.control.sidebar('Cause_Effect_Panel', {
    position: 'right'
});

	













// Add sidebar controls to the map


map.addControl(SPARQLPanel);
map.addControl(SPARQLPanel_edit);
map.addControl(Cause_Effect_Panel);

map.addControl(sir_sidebar);
map.addControl(sidebarLinks);



// Sidebar control functions
function Explore_cause_effect()
{
Cause_Effect_Panel.show();
SPARQLPanel.hide();
sir_sidebar.hide();
SPARQLPanel_edit.hide();
}


function Sparql_panel()
{
SPARQLPanel.show();
Cause_Effect_Panel.hide();

}


function Query()
{
sir_sidebar.show();
Cause_Effect_Panel.hide();
SPARQLPanel.hide();
SPARQLPanel_edit.hide();
}

function Sparql_panel_edit()
{
sir_sidebar.hide();
Cause_Effect_Panel.hide();
SPARQLPanel.hide();
SPARQLPanel_edit.show();

}


//add Geojson to the map

function test()
{
map.removeLayer(WL_boundary);
map.removeLayer(geojsonadd);
}

		
	

		

//Adding municipality borders

var WL_boundary= L.tileLayer('http://{s}.tiles.mapbox.com/{id}/{z}/{x}/{y}.png', {
    id: 'WL_boundary',
    attribution: 'GKZ',
	setOpacity:10,
})
WL_boundary.addTo(map);
var geojsonadd=L.geoJson(WLBoundaries, {style: style}).addTo(map);









//Adding map interaction

		// control that shows state info on hover
		//var info = L.control();

		info.onAdd = function (map) {
		// while: otherwise producing node error after removing L.control
		while(secondquery==false){
			this._div = L.DomUtil.create('div', 'info');
			this.update();
			return this._div;
		}
		};

		info.update = function (props) {
			this._div.innerHTML = '<h4>Region Westphalen Lippe</h4>' +  (props ?
				'<b>Municipality: ' + props.Name + '</b><br />GKZ: ' + props.GKZ + ''
				: 'Hover over a state');
		};

		info.addTo(map);


		// get color depending on population density value
		function getColor(d) {
			return d > 5554048 ? '#800026' :
			       d > 5555048 ? '#BD0026' :
			       d > 5556048 ? '#E31A1C' :
			       d > 5557048  ? '#FC4E2A' :
			       d > 5558048   ? '#FD8D3C' :
			       d > 5559048   ? '#FEB24C' :
			       d > 5564048  ? '#FED976' :
			                  '#FFEDA0';
		}
		
	

		function style(feature) {
			return {
				weight: 2,
				opacity: 1,
				color: 'white',
				dashArray: '3',
				fillOpacity: 0.7,
				fillColor: getColor(feature.properties.GKZ)
			};
		}

		function highlightFeature(e) {
			var layer = e.target;

			layer.setStyle({
				weight: 5,
				color: '#666',
				dashArray: '',
				fillOpacity: 0.7
			});

			if (!L.Browser.ie && !L.Browser.opera) {
				layer.bringToFront();
			}

			info.update(layer.feature.properties);
		}

		var geojson;

		function resetHighlight(e) {
			geojson.resetStyle(e.target);
			info.update();
		}

		function zoomToFeature(e) {
			map.fitBounds(e.target.getBounds());
		}

		function onEachFeature(feature, layer) {
			layer.on({
				mouseover: highlightFeature,
				mouseout: resetHighlight,
				click: zoomToFeature
			});
		}

		geojson = L.geoJson(WLBoundaries, {
			style: style,
			onEachFeature: onEachFeature
		}).addTo(map);

		map.attributionControl.addAttribution('Text?');


		var legend = L.control({position: 'bottomright'});

		legend.onAdd = function (map) {

			var div = L.DomUtil.create('div', 'info legend'),
				grades = [],  //0, 10, 20, 50, 100, 200, 500, 1000
				labels = [],
				from, to;

			for (var i = 0; i < grades.length; i++) {
				from = grades[i];
				to = grades[i + 1];

				labels.push(
					'<i style="background:' + getColor(from + 1) + '"></i> ' +
					from + (to ? '&ndash;' + to : '+'));
			}

			div.innerHTML = labels.join('<br>');
			return div;
		};

		legend.addTo(map);

/*		
if (secondquery==true){

    info.removeFrom(map)
    
}*/







////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
		
//OSM maps one as overlay and one base layer 
var osmUrl='http://a.tile.openstreetmap.org/{z}/{x}/{y}.png';
var osmAttrib='Map data &copy; OpenStreetMap contributors';
var layerOSM=L.tileLayer(osmUrl, {minZoom: 0, maxZoom: 18, attribution: osmAttrib});
var layerOSMtransparent=L.tileLayer('http://a.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy<a href="www.openstretmap.org/copyright ">OpenStreetMap</a> contributors',
	opacity:0.5,
    format: 'image/png',
	
});
//Layers of Geobasis NRW: http://www.bezreg-koeln.nrw.de/brk_internet/organisation/abteilung07/produkte/nrwatlas/index.html 
//                          (website which provides different Web Map Service (WMS)-URLs)
var layerDTK10_pan=L.tileLayer.wms('http://www.wms.nrw.de/geobasis/wms_nw_dtk10', {
   attribution: '| &copy Geobasis NRW 2013',
	layers: 'NW_DTK10_pan',
    format: 'image/png',
    transparent: true,
	opacity:0.4	
});
var layerDTK10=L.tileLayer.wms('http://www.wms.nrw.de/geobasis/wms_nw_dtk10', {
     attribution: '| &copy Geobasis NRW 2013',
	layers: 'nw_dtk10_pan,nw_dtk10_res,NW_DTK10_col,WMS_NW_DTK10',
    format: 'image/png',
    transparent: true
});
//layer of the different districts
var layerDVG=L.tileLayer.wms('http://www.wms.nrw.de/geobasis/wms_nw_dvg', {
     attribution: '| &copy Geobasis NRW 2013',
	layers: 'WMS_NW_DVG',
    format: 'image/png',
    transparent: true,
	opacity:0.5
});
var layerDGK5=L.tileLayer.wms('http://www.wms.nrw.de/geobasis/wms_nw_dgk5', {
 attribution: '| &copy Geobasis NRW 2013',
	layers: 'WMS_NW_DGK5',
    format: 'image/png',
    transparent: true,
	opacity:0.5
});
//Orthophoto layer
var layerOrtho = L.tileLayer.wms('http://www.wms.nrw.de/geobasis/wms_nw_dop40', {
    layers: 'WMS_NW_DOP40',
    format: 'image/png',
	version:'1.3.0',
    attribution: '| &copy Geobasis NRW 2013'
});




		

		
//The map which is visualized when you get on the website.
layerOSM.addTo(map);

//Map control: Layer switcher
var baseMaps={ "OSM": layerOSM,
               "arial view": layerOrtho,
			   "DTK10":layerDTK10
               };
var overlapMaps={"OSM":layerOSMtransparent,
                  "DVG":layerDVG,
				  "DTK10_pan":layerDTK10_pan,
				  "DGK5":layerDGK5,
				  };

var control=L.control.layers(baseMaps,overlapMaps,{position:'bottomleft'}).addTo(map);






//miniMap
	var osm2 = new L.TileLayer(osmUrl, {minZoom: 0, maxZoom: 13, attribution: osmAttrib });
//	var miniMap = new L.Control.MiniMap(osm2, { toggleDisplay: true }).addTo(map);

//measure Control 
	L.Control.measureControl().addTo(map);
	
	









	
//getlocation-- intialise a marker of your current position
//map.locate({setView: true, maxZoom: 16});

function mylocation()
{
navigator.geolocation.getCurrentPosition(GetLocation)
}

function GetLocation(location){
lat=location.coords.latitude;
lon=location.coords.longitude;

}

function onLocationFound(e) {
    var radius = e.accuracy / 2;

    L.marker(e.latlng,{icon: L.AwesomeMarkers.icon({icon: 'spinner', prefix: 'fa', markerColor: 'red', spin:true}) }).addTo(map)
        .bindPopup("You are within " + radius + " meters from this point. Do you want to start a query with this location?").openPopup();

    L.circle(e.latlng, radius).addTo(map);
	
	//lat=e.coords.latitude;
	//lon=e.coords.longitude;
	
}

map.on('locationfound', onLocationFound);

function onLocationError(e) {
    alert(e.message);
}


</script>

</div>

</div>
<div style="padding-left: 10px;padding-right: 10px; position:absolute; bottom:-10px; width:100%;">
            <input type="button" id="Btn1" value="Sparql ME" onclick="jsonmerge();" class="btnStyle span3" />
           
        </div>
	</body>
	</html>
